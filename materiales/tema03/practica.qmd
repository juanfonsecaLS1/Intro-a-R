---
title: "Tema 3: Práctica - Importando y Explorando Datos"
lang: es
---

## Objetivos

En esta práctica aprenderemos a:

-   Importar datos desde archivos CSV y Excel
-   Explorar datos usando funciones básicas
-   Obtener resúmenes estadísticos de nuestros datos

::: callout-note
## Requisitos

Asegúrate de estar trabajando dentro de un proyecto de RStudio con las carpetas `data/`, `scripts/` y `results/` creadas (como aprendiste en Tema 1).
:::

## 0. Preparación

### Descargar los Datos

Con este [link](https://raw.githubusercontent.com/juanfonsecaLS1/Intro-a-R/refs/heads/master/datos/datos.zip) se puede descargar el archivo ZIP con los conjuntos de datos que usaremos en esta práctica

-   *Encuesta de percepción sobre salud mental durante la cuarentena por COVID - 19 en Bogotá* obtenida de [Bogota Datos Abiertos](https://datosabiertos.bogota.gov.co/dataset/encuesta-de-percepcion-sobre-salud-mental-durante-la-cuarentena-por-covid-19-en-bogota/resource/884e98b3-eb71-4090-b752-1ba6818a8aed).

-   *Mercados Campesinos en Bogotá por UPL* disponibles a través de [Bogota Datos Abiertos](https://datosabiertos.bogota.gov.co/dataset/mercados-campesinos-en-bogota-por-localidades/resource/bf7c5690-de3d-44cd-9075-6fd43d38ec55?inner_span=True).

Guarda el archivo `datos.zip` en la carpeta `datos` de tu proyecto. Puedes descomprimir el archivo manualmente o usar R. El siguiente código te permite hacerlo desde la consola de R:

```{r}
unzip(
  zipfile = "datos/datos.zip",
  exdir = "datos"
)
```

Los archivos descomprimidos deberían ser visibles ahora en la pestana `Files`.

![](images/clipboard-3867670904.png)

### Instalar Paquetes Necesarios

Si aún no los tienes, instala los paquetes necesarios:

```{r}
#| eval: false
install.packages("readr")
install.packages("readxl")
```

### Cargar Paquetes

Crea un script en la carpeta `scripts` del proyecto que creamos en la primera sesión. Guárdalo como `01-cargando-datos.R`.

```{r}
library(readr)
library(readxl)
```

## 1. Importar Datos desde Excel

Para iniciar, vamos a usar el asistente para importar datos que tiene RStudio. En la pestaña `Environment`, puedes usar el botón `Import Dataset > From Excel...`

![](images/clipboard-4151129786.png)

Luego de escoger el archivo `datosabiertosmc_upl_30-09-2025.xls`, el asistente le mostrará una muestra de los datos, los tipos de datos en cada columna (recuerde la estructura de los data.frames), algunas opciones para importar los datos, y el código que puede usar para importar los datos manualmente en el futuro.

![](images/clipboard-851048879.png)

Al darle clic al botón `Import`, el asistente corre el código directamente en la consola. Sin embargo, en esta ocasión queremos que el código quede guardado. La idea es que copies el código generado por el asistente y lo pegues en tu script `01-cargando-datos.R`. El código debería verse así:

```{r}
datosabiertosmc_upl_30_09_2025 <- read_excel(
  "datos/datosabiertosmc_upl_30-09-2025.xls",
  sheet = "Sheet1"
)
```

Lo modificaremos un poco antes de correrlo. Por ahora, vamos a cambiar el nombre del objeto para que sea más sencillo de escribir. Usaremos `datos_mercados` en lugar del nombre largo generado por el asistente. Recuerda que el simbolo `<-` se usa para asignar un valor a un objeto en R, en este caso, el data.frame resultante de la importación de los datos.

::: callout-tip
Si al correr el código obtienes un error indicando que no se encuentra la función `read_excel()`, asegúrate de haber cargado el paquete `readxl` al inicio del script con `library(readxl)`.
:::

```{r}
# Importar datos de mercados campesinos
datos_mercados <- read_excel(
  "datos/datosabiertosmc_upl_30-09-2025.xls",
  sheet = "Sheet1"
)
```

Después de correr el código, el data.frame `datos_mercados` debería aparecer en la pestaña `Environment`.

![](images/paste-2.png)

Sabemos por el resumen en `Environment` que el data.frame tiene 182 filas (observaciones) y 17 columnas (variables). Vamos a explorar los datos un poco más. Primero, veamos los nombres de las columnas:

```{r}
names(datos_mercados)
```

Ahora, veamos las primeras filas del data.frame usando la función `head()`:

```{r}
head(datos_mercados)
```

## Explorando la Estructura de los Datos

Exploremos un poco más la estructura del data.frame usando la función `str()`:

```{r}
str(datos_mercados)
```

La función `str()` nos da un resumen más detallado de la estructura del data.frame, incluyendo el tipo de cada variable y algunos de sus valores.

La salida del comando `str()` nos indica que todos los datos fueron importados como texto (`chr`), lo cual no es ideal para análisis posteriores. Esto podemos corregirlo en el código que importa los datos, especificando los tipos de columnas apropiados. Por ejemplo, podemos convertir las columnas que representan fechas a tipo `Date`, y las columnas numéricas a tipo `numeric`.

Usando el asistente para importar los datos nuevamente, vamos a seleccionar los tipos de datos apropiados para cada columna. El código resultante debería verse algo así:

```{r}
#| warning: false

datos_mercados <- read_excel(
  "datos/datosabiertosmc_upl_30-09-2025.xls",
  sheet = "Sheet1",
  col_types = c(
    "text",
    "text",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric",
    "numeric"
  )
)


```

Esta vez, al correr el código se generan algunas advertencias indicando que algunas columnas no pudieron convertirse a numéricas debido a la presencia de valores no numéricos (por ejemplo, texto). Esto es normal, por ejemplo, cuando en lugar de 0 se encuentra un valor como "N/A" o "No disponible". R convierte esos valores a `NA` (valor faltante) automáticamente.

Explora la estructura de los datos nuevamente con `str()`, y verifica que las columnas numéricas ahora son de tipo `num`. Ahora que las columnas numéricas han sido convertidas correctamente, podemos proceder a obtener un resumen estadístico básico de los datos usando la función `summary()`:

```{r}
summary(datos_mercados)
```

Más adelante utilizaremos estos datos para hacer análisis más detallados.

## 2. Importar Datos de un Archivo Plano de Texto

Ahora vamos a importar datos desde un archivo CSV. Usaremos el archivo de la encuesta sobre salud mental durante la cuarentena por COVID-19 en Bogotá. Al igual que antes podemos usar el asistente para importar datos en RStudio. Esta vez seleccionamos `Import Dataset > From Text (readr)...`

![](images/clipboard-169485839.png)

En el asistente, seleccionamos el archivo `base_saludmental.csv`. El asistente nos muestra una vista previa de los datos y algunas opciones para la importación. Notemos que el archivo usa `;` como separador en lugar de la coma `,` que es más común en archivos CSV. En la opcion `Delimiter`, seleccionamos `Semicolon`.

![](images/paste-3.png)

Como se trata de un archivo con muchas columnas, vamos a importar solo las primeras 6. Para ello, en la opción para seleccionar el tipo de datos, seleccionamos `Only` para las preguntas hasta la pregunta 5.

![](images/paste-4.png)

De nuevo, vamos a copiar el código generado por el asistente y pegarlo en nuestro script. El código debería verse así:

```{r}
#| eval: false

library(readr)
base_saludmental <- read_delim(
  "datos/base_saludmental.csv",
  delim = ";",
  col_types = cols_only(
    `Marca temporal` = col_guess(),
    `1. Para empezar, nos gustaría saber qué tanto confía en la gente de su manzana o vecindario. Podría decir que entre sus vecinos usted confía en:` = col_guess(),
    `2. ¿Durante el mes pasado, qué tan seguido habló con sus vecinos?` = col_guess(),
    `3. ¿En un mes normal, antes de que comenzara el confinamiento en Bogotá a causa del COVID-19, con qué frecuencia hablaba con sus vecinos?` = col_guess(),
    `4. ¿Durante el mes pasado, qué tan seguido habló con sus amigos y familiares (incluyendo medios electrónicos como chats, redes sociales, llamadas telefónicas, videollamadas, etc.)?` = col_guess(),
    `5. En un mes normal, antes de que comenzara el confinamiento en Bogotá a causa del COVID-19, ¿con qué frecuencia hablaba con sus amigos y familiares (incluyendo medios electrónicos como chats, redes sociales, llamadas telefónicas, videollamadas, etc.)?` = col_guess()
  ),
  trim_ws = TRUE
)
View(base_saludmental)

```

```{r}
#| include: false

base_saludmental <- read_delim(
  "datos/base_saludmental.csv",
  delim = ";",
  trim_ws = TRUE,
)

```

Los conjuntos de datos con resultados de encuestas suelen tener muchas columnas, y cuyos nombres son largos y difíciles de manejar. Una buena práctica es renombrar las columnas con nombres más cortos y sencillos de usar.

Podemos renombrar las columnas para facilitar su uso posterior. Primero, veamos los nombres actuales de las columnas y guardemoslos en un objeto para referencia futura.

```{r}
nombres_largos <- names(base_saludmental)
nombres_largos
```

Ahora, creemos un vector con los nuevos nombres simplificados, asegurándonos que el número de nuevos nombres coincida con el número de columnas en el data.frame y en el mismo orden.

```{r}
nombres_simplificados <- c(
  "timestamp",
  "confianza_vecinos",
  "frec_habla_vecinos_cuarentena",
  "frec_habla_vecinos_pre",
  "frec_habla_amigos_cuarentena",
  "frec_habla_amigos_pre",
  "cumplimiento_propio",
  "cumplimiento_familiar",
  "cumplimiento_vecinos",
  "com_alcaldia_clara",
  "com_alcaldia_suficiente",
  "com_alcaldia_veridica",
  "com_alcaldia_oportuna",
  "com_alcaldia_contradictoria",
  "medios_info_alcaldia",
  "sabe_como_actuar_contagio",
  "info_suficiente_covid",
  "info_riesgos_alcaldia",
  "diagnostico_covid_conocido",
  "sm_ansioso_nervioso",
  "sm_decaido_deprimido",
  "sm_tranquilo",
  "convivencia_cercano",
  "sm_interes_placer",
  "habito_problemas_dormir",
  "convivencia_desacuerdos",
  "habito_necesidad_alcohol",
  "habito_necesidad_fumar",
  "habito_necesidad_spa",
  "preocupacion_principal",
  "apoyo_pareja",
  "apoyo_familia",
  "apoyo_amigos",
  "apoyo_empleador",
  "apoyo_vecinos",
  "apoyo_alcaldia",
  "apoyo_gob_nacional",
  "sexo",
  "edad_numero",
  "rango_edad",
  "enf_cronicas_hogar",
  "nivel_educativo",
  "localidad_residencia",
  "situacion_laboral",
  "condiciones_vivienda_comodidad",
  "num_personas_hogar_total",
  "num_personas_hogar_0_5",
  "num_personas_hogar_6_18",
  "num_personas_hogar_19_64",
  "num_personas_hogar_65_mas",
  "oportunidad_expresar_sentimientos",
  "frec_actividad_fisica",
  "riesgo_violencia_domestica",
  "diagnostico_sm_requiere_trat",
  "continuo_tratamiento_sm"
)
```

La función `names()` nos permite también asignar nombres a las columnas de un data.frame.

```{r}
# Renombrar columnas
names(base_saludmental) <- nombres_simplificados
```

Con los nuevos nombres, podemos seguir explorando los datos. Veamos las primeras filas con `head()`:

```{r}
head(base_saludmental)
```

El data.frame tiene 55 columnas, muchas de las cuales son respuestas a preguntas de la encuesta. Más adelante, en el análisis de datos, seleccionaremos solo las columnas relevantes para nuestro análisis. La función `summary()` nos da un resumen de todas las columnas:

```{r}
summary(base_saludmental)
```

Del resumen podemos ver que la mayoria de las columnas texto. Podemos explorar los valores de una columna específica usando la función `table()`. Por ejemplo, veamos los valores únicos en la columna `confianza_vecinos`:

```{r}
table(base_saludmental$confianza_vecinos)
```

También podemos generar tablas de frecuencias cruzando dos variables. Por ejemplo, veamos la relación entre `confianza_vecinos` y `frec_habla_vecinos_pre`:

```{r}
table(
  base_saludmental[, c("confianza_vecinos", "frec_habla_vecinos_pre")]
)
```

Es evidente que al menos para estas dos variables, se usaron escalas para las respuestas, más adelante veremos como transformar estas variales en factores ordenados para facilitar su análisis.