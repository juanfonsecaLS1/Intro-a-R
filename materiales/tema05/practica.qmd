---
title: "Pr√°ctica - La Gram√°tica de los Gr√°ficos con ggplot2"
lang: es
---

## Recurso √ötil

üìã **[ggplot2 Cheatsheet](https://rstudio.github.io/cheatsheets/html/data-visualization.html)** - Una gu√≠a visual r√°pida con los comandos m√°s comunes de ggplot2. √ösala como referencia mientras trabajas con los gr√°ficos.

## Objetivos

En esta pr√°ctica aprenderemos a:

-   Crear gr√°ficos de puntos con `geom_point()`
-   Mapear variables a atributos visuales (color, tama√±o, forma)
-   Crear gr√°ficos de barras con `geom_bar()` y `geom_col()`
-   Crear histogramas y gr√°ficos de densidad
-   Crear diagramas de caja (boxplot)
-   Personalizar t√≠tulos y etiquetas

::: callout-note
## Requisitos

Aseg√∫rate de haber completado la pr√°ctica para Importar datos y tener el dataset `datos_mercados`.
:::

## 0. Preparaci√≥n

Si a√∫n no tienes los datos cargados, crea un script llamado `05-visualizando-datos.R` en la carpeta `scripts` y carga los datos:

```{r}
#| eval: false
library(tidyverse) # ggplot2, dplyr, readr, etc.
library(readxl)

# Importar datos de mercados
datos_mercados <- read_excel(
  "datos/datosabiertosmc_upl_30-09-2025.xls",
  sheet = "Sheet1",
  col_types = c(
    "text",
    "text",
    rep("numeric", 15)
  )
) |>
  drop_na(PartProd, PartProdMujer, CantMC)

```

Ejecuta el script para cargar los datos en tu entorno.

## 1. Gr√°ficos de Puntos con `geom_point()`

### 1.1 Gr√°fico simple

Crea un gr√°fico de dispersi√≥n mostrando la relaci√≥n entre dos variables:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = CantMC, y = PartProdMujer)) +
  geom_point()
```

### 1.2 A√±adir color seg√∫n una variable categ√≥rica

Colorea los puntos seg√∫n el a√±o:

```{r}
#| eval: false
ggplot(
  datos_mercados,
  aes(x = CantMC, y = PartProdMujer, color = factor(A√±o))
) +
  geom_point(size = 2)
```

### 1.3 Mapear tama√±o seg√∫n una variable num√©rica

Cambia el tama√±o de los puntos seg√∫n la participaci√≥n de j√≥venes:

```{r}
#| eval: false
ggplot(
  datos_mercados,
  aes(
    x = CantMC,
    y = PartProdMujer,
    color = factor(A√±o),
    size = PartProdJoven
  )
) +
  geom_point(alpha = 0.6)
```

## 2. Gr√°ficos de Barras

### 2.1 Conteo simple

Cuenta cu√°ntos mercados hay por trimestre:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = Trimestre)) +
  geom_bar()
```

### 2.2 Barras con valores espec√≠ficos

Calcula el promedio de participaci√≥n femenina por a√±o y visualiza:

```{r}
#| eval: false
datos_mercados |>
  group_by(A√±o) |>
  summarise(promedio_mujeres = mean(PartProdMujer, na.rm = TRUE)) |>
  ggplot(aes(x = factor(A√±o), y = promedio_mujeres)) +
  geom_col(fill = "steelblue")
```

### 2.3 Barras por grupos

Muestra la cantidad de mercados por UPL y a√±o (para las 3 UPLs principales):

```{r}
#| eval: false
datos_mercados |>
  filter(NombreUPL %in% c("Suba", "Usaqu√©n", "Chapinero")) |>
  group_by(NombreUPL, A√±o) |>
  summarise(cantidad = n(), .groups = "drop") |>
  ggplot(aes(x = NombreUPL, y = cantidad, fill = factor(A√±o))) +
  geom_col(position = "dodge")
```

## 3. Histogramas y Densidad

### 3.1 Histograma

Visualiza la distribuci√≥n de participantes por mercado:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = PartProd)) +
  geom_histogram(bins = 30, fill = "coral")
```

### 3.2 Gr√°fico de densidad

Compara la distribuci√≥n de participaci√≥n femenina:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = PartProdMujer, fill = factor(A√±o))) +
  geom_density(alpha = 0.5)
```

## 4. Diagramas de Caja (Boxplot)

### 4.1 Boxplot simple

Compara la participaci√≥n femenina por trimestre:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = factor(Trimestre), y = PartProdMujer)) +
  geom_boxplot(fill = "lightblue")
```


## 5. Personalizando Gr√°ficos

### 5.1 A√±adir t√≠tulos y etiquetas

Crea un gr√°fico con t√≠tulos personalizados:

```{r}
#| eval: false
datos_mercados |>
  group_by(A√±o) |>
  summarise(promedio_mujeres = mean(PartProdMujer, na.rm = TRUE)) |>
  ggplot(aes(x = factor(A√±o), y = promedio_mujeres)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Participaci√≥n Promedio de Mujeres en Mercados",
    subtitle = "Por a√±o",
    x = "A√±o",
    y = "Participaci√≥n Promedio (%)",
    caption = "Fuente: datos_mercados"
  ) +
  theme_minimal()
```

### 5.2 Cambiar temas

Experimenta con diferentes temas predefinidos:

```{r}
#| eval: false
# Gr√°fico base
p <- ggplot(
  datos_mercados,
  aes(x = CantMC, y = PartProdMujer, color = factor(A√±o))
) +
  geom_point(size = 2)

# Prueba diferentes temas
p + theme_minimal()
p + theme_light()
p + theme_classic()
p + theme_dark()
```

## 6. Guardando Gr√°ficos

Guarda tus gr√°ficos como im√°genes:

```{r}
#| eval: false
# Crear un gr√°fico
p <- ggplot(datos_mercados, aes(x = Trimestre)) +
  geom_bar() +
  labs(title = "Mercados por Trimestre") +
  theme_minimal()

# Guardar como PNG
ggsave(
  filename = "resultados/grafico_mercados.png",
  plot = p,
  unit = "cm",
  width = 20,
  height = 15
)

```

## 7. Resumen

En esta pr√°ctica aprendiste a:

1. ‚úÖ Crear gr√°ficos de dispersi√≥n con `geom_point()`
2. ‚úÖ Mapear variables a atributos visuales (color, tama√±o, forma)
3. ‚úÖ Crear gr√°ficos de barras con `geom_bar()` y `geom_col()`
4. ‚úÖ Visualizar distribuciones con histogramas y gr√°ficos de densidad
5. ‚úÖ Comparar grupos con diagramas de caja (boxplots)
6. ‚úÖ Personalizar gr√°ficos con t√≠tulos, etiquetas y temas
7. ‚úÖ Guardar gr√°ficos como archivos de imagen

::: {.callout-tip}
**Pr√≥ximos pasos:** ggplot2 tiene muchas m√°s geometr√≠as y opciones de personalizaci√≥n. Consulta la [Cheatsheet de ggplot2](https://rstudio.github.io/cheatsheets/html/data-visualization.html) para explorar m√°s posibilidades.
:::
