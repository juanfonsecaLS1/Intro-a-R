---
title: "Tema 5: Pr치ctica - La Gram치tica de los Gr치ficos con ggplot2"
lang: es
---

## Recurso 칔til

游늶 **[ggplot2 Cheatsheet](https://rstudio.github.io/cheatsheets/html/data-visualization.html)** - Una gu칤a visual r치pida con los comandos m치s comunes de ggplot2. 칔sala como referencia mientras trabajas con los gr치ficos.

## Objetivos

En esta pr치ctica aprenderemos a:

-   Crear gr치ficos de puntos con `geom_point()`
-   Mapear variables a atributos visuales (color, tama침o, forma)
-   Crear gr치ficos de barras con `geom_bar()` y `geom_col()`
-   Crear histogramas y gr치ficos de densidad
-   Crear diagramas de caja (boxplot)
-   Personalizar t칤tulos y etiquetas

::: callout-note
## Requisitos

Aseg칰rate de haber completado la pr치ctica para Importar datos y tener el dataset `datos_mercados`.
:::

## 0. Preparaci칩n

Si a칰n no tienes los datos cargados, crea un script llamado `05-visualizando-datos.R` en la carpeta `scripts` y carga los datos:

```{r}
#| eval: false
library(tidyverse) # ggplot2, dplyr, readr, etc.
library(readxl)

# Importar datos de mercados
datos_mercados <- read_excel(
  "datos/datosabiertosmc_upl_30-09-2025.xls",
  sheet = "Sheet1",
  col_types = c(
    "text",
    "text",
    rep("numeric", 15)
  )
) |>
  drop_na(PartProd, PartProdMujer, CantMC)

```

Ejecuta el script para cargar los datos en tu entorno.

## 1. Gr치ficos de Puntos con `geom_point()`

### 1.1 Gr치fico simple

Crea un gr치fico de dispersi칩n mostrando la relaci칩n entre dos variables:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = CantMC, y = PartProdMujer)) +
  geom_point()
```

### 1.2 A침adir color seg칰n una variable categ칩rica

Colorea los puntos seg칰n el a침o:

```{r}
#| eval: false
ggplot(
  datos_mercados,
  aes(x = CantMC, y = PartProdMujer, color = factor(A침o))
) +
  geom_point(size = 2)
```

### 1.3 Mapear tama침o seg칰n una variable num칠rica

Cambia el tama침o de los puntos seg칰n la participaci칩n de j칩venes:

```{r}
#| eval: false
ggplot(
  datos_mercados,
  aes(
    x = CantMC,
    y = PartProdMujer,
    color = factor(A침o),
    size = PartProdJoven
  )
) +
  geom_point(alpha = 0.6)
```

## 2. Gr치ficos de Barras

### 2.1 Conteo simple

Cuenta cu치ntos mercados hay por trimestre:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = Trimestre)) +
  geom_bar()
```

### 2.2 Barras con valores espec칤ficos

Calcula el promedio de participaci칩n femenina por a침o y visualiza:

```{r}
#| eval: false
datos_mercados |>
  group_by(A침o) |>
  summarise(promedio_mujeres = mean(PartProdMujer, na.rm = TRUE)) |>
  ggplot(aes(x = factor(A침o), y = promedio_mujeres)) +
  geom_col(fill = "steelblue")
```

### 2.3 Barras por grupos

Muestra la cantidad de mercados por UPL y a침o (para las 3 UPLs principales):

```{r}
#| eval: false
datos_mercados |>
  filter(NombreUPL %in% c("Suba", "Usaqu칠n", "Chapinero")) |>
  group_by(NombreUPL, A침o) |>
  summarise(cantidad = n(), .groups = "drop") |>
  ggplot(aes(x = NombreUPL, y = cantidad, fill = factor(A침o))) +
  geom_col(position = "dodge")
```

## 3. Histogramas y Densidad

### 3.1 Histograma

Visualiza la distribuci칩n de participantes por mercado:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = PartProd)) +
  geom_histogram(bins = 30, fill = "coral")
```

### 3.2 Gr치fico de densidad

Compara la distribuci칩n de participaci칩n femenina:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = PartProdMujer, fill = factor(A침o))) +
  geom_density(alpha = 0.5)
```

## 4. Diagramas de Caja (Boxplot)

### 4.1 Boxplot simple

Compara la participaci칩n femenina por trimestre:

```{r}
#| eval: false
ggplot(datos_mercados, aes(x = factor(Trimestre), y = PartProdMujer)) +
  geom_boxplot(fill = "lightblue")
```


## 5. Personalizando Gr치ficos

### 5.1 A침adir t칤tulos y etiquetas

Crea un gr치fico con t칤tulos personalizados:

```{r}
#| eval: false
datos_mercados |>
  group_by(A침o) |>
  summarise(promedio_mujeres = mean(PartProdMujer, na.rm = TRUE)) |>
  ggplot(aes(x = factor(A침o), y = promedio_mujeres)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Participaci칩n Promedio de Mujeres en Mercados",
    subtitle = "Por a침o",
    x = "A침o",
    y = "Participaci칩n Promedio (%)",
    caption = "Fuente: datos_mercados"
  ) +
  theme_minimal()
```

### 5.2 Cambiar temas

Experimenta con diferentes temas predefinidos:

```{r}
#| eval: false
# Gr치fico base
p <- ggplot(
  datos_mercados,
  aes(x = CantMC, y = PartProdMujer, color = factor(A침o))
) +
  geom_point(size = 2)

# Prueba diferentes temas
p + theme_minimal()
p + theme_light()
p + theme_classic()
p + theme_dark()
```

## 6. Guardando Gr치ficos

Guarda tus gr치ficos como im치genes:

```{r}
#| eval: false
# Crear un gr치fico
p <- ggplot(datos_mercados, aes(x = Trimestre)) +
  geom_bar() +
  labs(title = "Mercados por Trimestre") +
  theme_minimal()

# Guardar como PNG
ggsave(
  filename = "resultados/grafico_mercados.png",
  plot = p,
  unit = "cm",
  width = 20,
  height = 15
)

```
